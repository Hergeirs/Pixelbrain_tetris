{"ast":null,"code":"import _regeneratorRuntime from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/regenerator\";\nimport _objectSpread from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _asyncToGenerator from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _toConsumableArray from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport _classCallCheck from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/createClass\";\n//@ts-nocheck\nimport Vector from \"../Vector/Vector\";\nimport Timer from \"../Timer/Timer\";\nimport EventManager from \"../EventManager/EventManager\"; // @ts-ignore\n\nArray.prototype.filterInPlace = function (predicate) {\n  for (var i = 0; i < this.length; ++i) {\n    if (predicate(this[i])) {\n      this[this.length - 1] = this[i];\n      this.pop();\n    }\n  }\n};\n\nvar PhysicsEngine =\n/*#__PURE__*/\nfunction () {\n  _createClass(PhysicsEngine, null, [{\n    key: \"instance\",\n    get: function get() {\n      if (PhysicsEngine._instance === undefined) {\n        PhysicsEngine._instance = new PhysicsEngine();\n      }\n\n      return PhysicsEngine._instance;\n    }\n  }]);\n\n  function PhysicsEngine() {\n    var _this = this;\n\n    _classCallCheck(this, PhysicsEngine);\n\n    this.gravityVector = new Vector([0, 9.82]);\n\n    this.totalForce = function (gameObject) {\n      var totalForce = new Vector(_toConsumableArray(gameObject.force.vector));\n      totalForce = totalForce.plus(_this.dragForce(gameObject));\n      totalForce = totalForce.plus(_this.gravityForce(gameObject));\n      return totalForce;\n    };\n\n    this.rigidBodies = [];\n\n    this.add = function (body) {\n      _this.rigidBodies.push(body);\n    };\n\n    this.processRigidBodies = function (dt) {\n      _this.rigidBodies.forEach(function (element) {\n        _this.processRigidBody(element, dt);\n      });\n    };\n  }\n\n  _createClass(PhysicsEngine, [{\n    key: \"gravityForce\",\n    //gravity on object\n    value: function gravityForce(gameObject) {\n      return this.gravityVector.multiply(gameObject.weight).multiply(gameObject.gravity);\n    }\n  }, {\n    key: \"dragForce\",\n    value: function dragForce(gameObject) {\n      return new Vector([-Math.sign(gameObject.velocity.x) * Math.pow(gameObject.velocity.x, 2), -Math.sign(gameObject.velocity.y) * Math.pow(gameObject.velocity.y, 2)]).multiply(gameObject.drag);\n    }\n  }, {\n    key: \"remove\",\n    value: function remove(body) {\n      //@ts-ignore\n      this.rigidBodies = this.rigidBodies.filter(function (aBody) {\n        return aBody !== body;\n      });\n    }\n  }, {\n    key: \"processRigidBody\",\n    value: function processRigidBody(gameObject, deltaTime) {\n      var totalForce = this.totalForce(gameObject);\n      gameObject.acceleration = totalForce.divide(gameObject.weight);\n      gameObject.velocity = gameObject.velocity.plus(gameObject.acceleration.multiply(deltaTime / 1000));\n      gameObject.position = gameObject.position.plus(gameObject.velocity.multiply(deltaTime / 1000));\n    }\n  }, {\n    key: \"processEvent\",\n    value: function processEvent(event) {\n      var physics = event.physics,\n          end = event.end;\n      if (!physics) return;\n\n      if (!event.gameObject) {\n        throw \"PhysicsEngine: gameObject is undefined or null\";\n      }\n\n      if (!event.gameObject.rigidBody) {\n        throw \"PhysicsEngine: physics event fired withour rigidBody\";\n      }\n\n      var gameObject = event.gameObject.rigidBody;\n      if (!physics || !physics.force) return;\n      var duration = physics.duration;\n\n      if (end) {\n        gameObject.force = gameObject.force.minus(physics.force);\n      } else {\n        //@ts-ignore\n        gameObject.force = gameObject.force.plus(physics.force);\n\n        if (duration) {\n          Timer.instance.subscribeToTime(\n          /*#__PURE__*/\n          _asyncToGenerator(\n          /*#__PURE__*/\n          _regeneratorRuntime.mark(function _callee() {\n            return _regeneratorRuntime.wrap(function _callee$(_context) {\n              while (1) {\n                switch (_context.prev = _context.next) {\n                  case 0:\n                    EventManager.instance.registerEvent(_objectSpread({}, event, {\n                      end: true\n                    }));\n\n                  case 1:\n                  case \"end\":\n                    return _context.stop();\n                }\n              }\n            }, _callee);\n          })), duration);\n        }\n      }\n    }\n  }]);\n\n  return PhysicsEngine;\n}();\n\nPhysicsEngine._instance = void 0;\nexport default PhysicsEngine;","map":{"version":3,"sources":["/home/hergeirs/Setri/ForritaVerkfrøði/Pixelbrain_tetris/src/PhysicsEngine/PhysicsEngine.ts"],"names":["Vector","Timer","EventManager","Array","prototype","filterInPlace","predicate","i","length","pop","PhysicsEngine","_instance","undefined","gravityVector","totalForce","gameObject","force","vector","plus","dragForce","gravityForce","rigidBodies","add","body","push","processRigidBodies","dt","forEach","element","processRigidBody","multiply","weight","gravity","Math","sign","velocity","x","y","drag","filter","aBody","deltaTime","acceleration","divide","position","event","physics","end","rigidBody","duration","minus","instance","subscribeToTime","registerEvent"],"mappings":"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","sourcesContent":["//@ts-nocheck\nimport Vector from \"../Vector/Vector\";\nimport Event from \"../Events/Event\";\nimport Timer from \"../Timer/Timer\";\nimport EventManager from \"../EventManager/EventManager\";\n\n// @ts-ignore\nArray.prototype.filterInPlace = function(predicate) {\n  for (let i = 0; i < this.length; ++i) {\n    if (predicate(this[i])) {\n      this[this.length - 1] = this[i];\n      this.pop();\n    }\n  }\n};\n\nclass PhysicsEngine {\n  private static _instance: PhysicsEngine;\n  public static get instance() {\n    if (PhysicsEngine._instance === undefined) {\n      PhysicsEngine._instance = new PhysicsEngine();\n    }\n    return PhysicsEngine._instance;\n  }\n\n  private constructor() {}\n\n  private gravityVector = new Vector([0, 9.82]);\n\n  //gravity on object\n  private gravityForce(gameObject: any): Vector {\n    return this.gravityVector\n      .multiply(gameObject.weight)\n      .multiply(gameObject.gravity);\n  }\n\n  private dragForce(gameObject: any) {\n    return new Vector([\n      -Math.sign(gameObject.velocity.x) * gameObject.velocity.x ** 2,\n      -Math.sign(gameObject.velocity.y) * gameObject.velocity.y ** 2\n    ]).multiply(gameObject.drag);\n  }\n  private totalForce = (gameObject: any): Vector => {\n    let totalForce = new Vector([...gameObject.force.vector]);\n    totalForce = totalForce.plus(this.dragForce(gameObject));\n    totalForce = totalForce.plus(this.gravityForce(gameObject));\n    return totalForce;\n  };\n\n  private rigidBodies: any = [];\n  public add = (body: any) => {\n    this.rigidBodies.push(body);\n  };\n\n  public remove(body: any) {\n    //@ts-ignore\n    this.rigidBodies = this.rigidBodies.filter(aBody => aBody !== body);\n  }\n\n  public processRigidBodies = (dt: number) => {\n    this.rigidBodies.forEach((element: any) => {\n      this.processRigidBody(element, dt);\n    });\n  };\n\n  public processRigidBody(gameObject: any, deltaTime: number) {\n    const totalForce = this.totalForce(gameObject);\n    gameObject.acceleration = totalForce.divide(gameObject.weight);\n    gameObject.velocity = gameObject.velocity.plus(\n      gameObject.acceleration.multiply(deltaTime / 1000)\n    );\n\n    gameObject.position = gameObject.position.plus(\n      gameObject.velocity.multiply(deltaTime / 1000)\n    );\n  }\n\n  public processEvent(event: Event) {\n    const { physics, end } = event;\n    if (!physics) return;\n\n    if (!event.gameObject) {\n      throw \"PhysicsEngine: gameObject is undefined or null\";\n    }\n\n    if (!event.gameObject.rigidBody) {\n      throw \"PhysicsEngine: physics event fired withour rigidBody\";\n    }\n\n    const gameObject = event.gameObject.rigidBody;\n\n    if (!physics || !physics.force) return;\n    const { duration } = physics;\n\n    if (end) {\n      gameObject.force = gameObject.force.minus(physics.force);\n    } else {\n      //@ts-ignore\n      gameObject.force = gameObject.force.plus(physics.force);\n      if (duration) {\n        Timer.instance.subscribeToTime(async () => {\n          EventManager.instance.registerEvent({\n            ...event,\n            end: true\n          });\n        }, duration);\n      }\n    }\n  }\n}\n\nexport default PhysicsEngine;\n"]},"metadata":{},"sourceType":"module"}