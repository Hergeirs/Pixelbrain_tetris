{"ast":null,"code":"import _classCallCheck from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/classCallCheck\";\nimport _createClass from \"/home/hergeirs/Setri/ForritaVerkfr\\xF8\\xF0i/Pixelbrain_tetris/node_modules/@babel/runtime/helpers/esm/createClass\";\nimport Game from \"../Resources/Games/Tetris/Game\";\n\nvar Timer =\n/*#__PURE__*/\nfunction () {\n  _createClass(Timer, [{\n    key: \"framerate\",\n    set: function set(framerate) {\n      this._interval = 1000 / framerate;\n    }\n  }], [{\n    key: \"instance\",\n    get: function get() {\n      if (Timer._instance === undefined) Timer._instance = new Timer(0.1);\n      return Timer._instance;\n    }\n  }]);\n\n  function Timer() {\n    var _this = this;\n\n    var framerate = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 30;\n\n    _classCallCheck(this, Timer);\n\n    this.subscribe = function (callback) {\n      return _this.callbacks.push(callback);\n    };\n\n    this.subscribeToTime = function (callback, offset) {\n      return _this.oneTimeCallBacks.push({\n        time: _this.now() + offset,\n        callback: callback\n      });\n    };\n\n    this.handleOneTimersEnter = true;\n\n    this.handleOneTimers = function () {\n      if (_this.handleOneTimersEnter) {\n        _this.handleOneTimersEnter = false;\n      } else return;\n\n      var length = _this.oneTimeCallBacks.length;\n\n      for (var i = 0; i < _this.oneTimeCallBacks.length; ++i) {\n        if (_this.oneTimeCallBacks[i] && _this.oneTimeCallBacks[i].time <= _this.now()) {\n          _this.oneTimeCallBacks[i].callback();\n\n          _this.oneTimeCallBacks[i] = _this.oneTimeCallBacks[length - 1];\n\n          _this.oneTimeCallBacks.pop();\n        }\n      }\n\n      _this.handleOneTimersEnter = true;\n    };\n\n    this.unsubscribe = function (callback) {\n      var callbacks = _this.callbacks;\n      if (!callbacks.length) return false; // poor implementation, but can't think of a better way atm...\n\n      var idx = callbacks.findIndex(function (val) {\n        return val.name === callback.name && val.toString() === callback.toString();\n      });\n      return idx === -1 ? false : !!callbacks.splice(idx, 1);\n    };\n\n    this.pause = false;\n\n    this.step = function () {\n      requestAnimationFrame(_this.step);\n\n      if (Game.instance.pause) {\n        _this.time = _this.now();\n        return;\n      }\n\n      _this.handleOneTimers();\n\n      var dt = _this.now() - _this.time;\n\n      if (dt >= _this._interval) {\n        _this.time = _this.now();\n\n        _this.callbacks.forEach(function (val) {\n          return val(dt);\n        });\n      }\n    };\n\n    this.now = require(\"performance-now\");\n    this.framerate = framerate;\n    this.callbacks = [];\n    this.oneTimeCallBacks = [];\n    this.time = this.now();\n    requestAnimationFrame(this.step);\n  } //subscriba til gameLoop\n\n\n  return Timer;\n}();\n\nTimer._instance = undefined;\nexport { Timer as default };","map":{"version":3,"sources":["/home/hergeirs/Setri/ForritaVerkfrøði/Pixelbrain_tetris/src/Timer/Timer.js"],"names":["Game","Timer","framerate","_interval","_instance","undefined","subscribe","callback","callbacks","push","subscribeToTime","offset","oneTimeCallBacks","time","now","handleOneTimersEnter","handleOneTimers","length","i","pop","unsubscribe","idx","findIndex","val","name","toString","splice","pause","step","requestAnimationFrame","instance","dt","forEach","require"],"mappings":"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","sourcesContent":["import Game from \"../Resources/Games/Tetris/Game\";\n\nexport default class Timer {\n  static _instance = undefined;\n  static get instance() {\n    if (Timer._instance === undefined) Timer._instance = new Timer(0.1);\n    return Timer._instance;\n  }\n\n  set framerate(framerate) {\n    this._interval = 1000 / framerate;\n  }\n  constructor(framerate = 30) {\n    this.now = require(\"performance-now\");\n    this.framerate = framerate;\n    this.callbacks = [];\n    this.oneTimeCallBacks = [];\n    this.time = this.now();\n    requestAnimationFrame(this.step);\n  }\n\n  //subscriba til gameLoop\n  subscribe = callback => this.callbacks.push(callback);\n\n  subscribeToTime = (callback, offset) =>\n    this.oneTimeCallBacks.push({\n      time: this.now() + offset,\n      callback: callback\n    });\n\n  handleOneTimersEnter = true;\n\n  handleOneTimers = () => {\n    if (this.handleOneTimersEnter) {\n      this.handleOneTimersEnter = false;\n    } else return;\n    const length = this.oneTimeCallBacks.length;\n    for (let i = 0; i < this.oneTimeCallBacks.length; ++i)\n      if (\n        this.oneTimeCallBacks[i] &&\n        this.oneTimeCallBacks[i].time <= this.now()\n      ) {\n        this.oneTimeCallBacks[i].callback();\n        this.oneTimeCallBacks[i] = this.oneTimeCallBacks[length - 1];\n        this.oneTimeCallBacks.pop();\n      }\n    this.handleOneTimersEnter = true;\n  };\n\n  unsubscribe = callback => {\n    const { callbacks } = this;\n    if (!callbacks.length) return false;\n    // poor implementation, but can't think of a better way atm...\n    const idx = callbacks.findIndex(\n      val =>\n        val.name === callback.name && val.toString() === callback.toString()\n    );\n    return idx === -1 ? false : !!callbacks.splice(idx, 1);\n  };\n  // should come elsewhere\n  pause = false;\n\n  step = () => {\n    requestAnimationFrame(this.step);\n    if (Game.instance.pause) {\n      this.time = this.now();\n      return;\n    }\n    this.handleOneTimers();\n    const dt = this.now() - this.time;\n    if (dt >= this._interval) {\n      this.time = this.now();\n      this.callbacks.forEach(val => val(dt));\n    }\n  };\n}\n"]},"metadata":{},"sourceType":"module"}